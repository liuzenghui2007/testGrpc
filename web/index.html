<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>gRPC-Web Test</title>
</head>
<body>
    <h1>gRPC-Web Client Test</h1>
    <!-- 这里在Vue应用外部，不能使用Vue -->
    <button id="fetchStreams">Fetch Streams - outside Vue</button>
    <div id="streams-container"></div>
        
    <div id="app">
        <button @click="fetchRandomStrings">Fetch Random Strings</button>
        <!-- 显示总成功数和失败数 -->
        <h2>Total Success: {{ totalSuccess }}</h2>
        <h2>Total Failures: {{ totalFailures }}</h2>

        <!-- 混合显示成功和失败的请求 -->
        <div v-for="item in requests" :key="item.index">
            <span v-if="item.status === 'success'">
                {{ item.index }} : Success - {{ item.str }}
            </span>
            <span v-else="">
                {{ item.index }} : Failed
            </span>
        </div>
    </div>

    <!-- 新增按钮和显示区域 -->
    <button id="fetchMultipleStreams">Fetch Multiple Streams</button>
    <div id="multipleStreamsContainer"></div>

    <script type="module">
      import { createApp, ref, computed } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
      import { getOne, getStream } from './api.js';

      createApp({
        setup() {
          // Existing Vue app setup...
        }
      }).mount('#app');

      // Handling fetching multiple streams
      document.getElementById('fetchMultipleStreams').addEventListener('click', () => {
        const container = document.getElementById('multipleStreamsContainer');
        container.innerHTML = ''; // Clear previous results
        for (let i = 0; i < 10; i++) {
          const streamContainer = document.createElement('div');
          streamContainer.id = `multiple-stream-${i}`;
          streamContainer.innerHTML = `<h3>Stream ${i}</h3>`;
          container.appendChild(streamContainer);

          const stream = getStream();
          stream.on('data', (response) => {
            const message = document.createElement('p');
            console.log('stream response', response.toObject())
            message.textContent = response.toObject().uuid; // Assuming getMessage() is the method to get the message from the response
            streamContainer.appendChild(message);
          });

          stream.on('end', () => {
            const message = document.createElement('p');
            message.textContent = 'Stream ended.';
            streamContainer.appendChild(message);
          });
        }
      });
    </script>
</body>
</html>